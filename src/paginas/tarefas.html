<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Tarefas • Dashboard</title>
    
    <!-- Fonte -->
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide icons -->
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.278.0/dist/lucide.min.js" defer></script>

    <style>
        :root{
            --bg:#f6fbfd;
            --card:#ffffff;
            --muted:#6b7280;
            --primary-1:#3968FF;
            --primary-2:#4AD6C1;
            --glass: rgba(255,255,255,0.65);
            --shadow: rgba(20,20,40,0.06);
            --accent:#10b981;

            /* text / bg for theme switching */
            --page-bg: var(--bg);
            --text: #0b1220;
            --muted-2: #6b7280;
            --card-bg: var(--card);
            --sidebar-bg: #ffffff;
            --menu-hover-bg: rgba(57,104,255,0.06);
        }

        /* Dark theme overrides */
        .dark {
            --page-bg: #0b1220;
            --text: #e6eef6;
            --muted-2: #94a3b8;
            --card-bg: #071127;
            --sidebar-bg: linear-gradient(180deg,#071127,#071827);
            --menu-hover-bg: rgba(255,255,255,0.04);
        }

        *{box-sizing:border-box;margin:0;padding:0}
        html,body{height:100%;font-family:'Baloo 2',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--page-bg);color:var(--text)}
        a{color:inherit;text-decoration:none}

        .app {
            min-height:100vh;
            display:flex;
            padding:0;
        }

        /* Dashboard */
        .dashboard {
            width:100%;
            min-height:100vh;
            background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.95));
            display:flex;
            transition:opacity .25s ease, transform .25s ease, background .25s ease;
            color:var(--text);
        }
        .dark .dashboard { background: linear-gradient(180deg, rgba(5,8,12,0.6), rgba(4,6,10,0.8)); }

        .sidebar {
            width:220px;
            background:var(--sidebar-bg);
            padding:16px;
            display:flex;
            flex-direction:column;
            gap:14px;
            box-shadow:0 8px 28px var(--shadow);
            border:1px solid rgba(0,0,0,0.03);
        }

        .profile {display:flex; gap:12px; align-items:center}
        .profile img{width:56px;height:56px;border-radius:50%;object-fit:cover; border:2px solid rgba(0,0,0,0.04)}
        .profile h1{font-size:15px; font-weight:700; color:var(--text)}
        .menu{list-style:none; display:flex; flex-direction:column; gap:8px; padding-top:6px}
        /* menu links and buttons share same visual style */
        .menu-item {
            display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; color:var(--muted-2); font-weight:600;
            cursor:pointer; background:transparent; border:0; text-align:left; transition: background .14s, transform .08s, color .12s;
            width:100%;
        }
        .menu-item i, .menu-item svg { width:18px;height:18px; opacity:0.95; flex-shrink:0; }
        .menu-item span { flex:1; text-align:left; }

        .menu-item:hover{ background: var(--menu-hover-bg); color: #0b1220; transform: translateY(-1px) }
        .dark .menu-item:hover{ color: var(--text) }

        .sidebar-footer { margin-top:auto; display:flex; flex-direction:column; gap:8px; }
        .menu-btn { display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; background:transparent; border:0; color:var(--muted-2); cursor:pointer; font-weight:600; transition: background .12s, transform .08s; width:100%; text-align:left }
        .menu-btn:hover { background: var(--menu-hover-bg); color: #0b1220; transform: translateY(-1px) }
        .dark .menu-btn:hover { color: var(--text) }

        .main { flex:1; padding:22px; display:flex; flex-direction:column; gap:18px }

        .topbar {display:flex; justify-content:space-between; align-items:center; gap:12px}
        .cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:18px; margin-top:8px}
        .card{background:var(--card-bg); border-radius:12px; padding:16px; box-shadow:0 6px 18px var(--shadow)}
        .card h4{font-size:13px; color:var(--muted-2); margin-bottom:6px}
        .card .num{font-size:34px; font-weight:800; color: var(--text)}

        .panel {
            background:var(--card-bg);
            border-radius:12px;
            padding:14px;
            box-shadow:0 10px 30px var(--shadow);
            border:1px solid rgba(0,0,0,0.03);
        }

        /* buttons (primary / outline / danger / icon) */
        .btn { 
            display:inline-flex; gap:8px; align-items:center; justify-content:center; 
            padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:700; border:0;
            transition:transform .12s ease, opacity .12s ease;
        }
        .btn svg{width:14px;height:14px}
        .btn-primary { 
            background:linear-gradient(90deg,var(--primary-1),var(--primary-2)); 
            color:#fff;
        }
        .btn-outline { 
            background:transparent; 
            border:1px solid rgba(0,0,0,0.06); 
            color:var(--muted-2);
        }
        .btn-danger { 
            background:#ef4444; 
            color:#fff;
        }
        .btn-secondary { 
            background:#e6eef6; 
            color:#0b1220;
        }
        .btn-icon { 
            background:transparent; 
            border:1px solid rgba(0,0,0,0.06); 
            padding:8px; 
            border-radius:8px; 
            display:inline-flex; 
            align-items:center; 
            justify-content:center;
        }
        
        /* Botão Menu com estilo da página Login - Dashboard */
        #mobileMenuBtn {
            display:inline-flex; 
            align-items:center; 
            justify-content:center;
            gap:8px; 
            width:auto; 
            padding:8px 10px; 
            border-radius:10px; 
            border:none; 
            cursor:pointer;
            background: linear-gradient(90deg,var(--primary-1),var(--primary-2));
            color:#fff; 
            font-weight:700; 
            font-size:15px; 
            transition:transform .12s ease, opacity .12s ease;
        }
        .btn:active{transform:translateY(1px)}

        /* modal */
        .modal { 
            position:fixed; 
            inset:0; 
            display:none; 
            align-items:center; 
            justify-content:center; 
            background: rgba(5,6,10,0.4); 
            z-index:1200;
        }
        .modal.show { display:flex }
        .modal-content { 
            width:100%; 
            max-width:820px; 
            background:var(--card-bg); 
            border-radius:12px; 
            padding:18px; 
            box-shadow:0 10px 40px var(--shadow); 
            border:1px solid rgba(0,0,0,0.04);
        }
        .modal-header { 
            display:flex; 
            justify-content:space-between; 
            align-items:center; 
            margin-bottom:12px;
        }
        .modal-header h2{margin:0}
        .modal .close { cursor:pointer; font-size:22px; color:var(--muted-2) }

        .modal-form .form-row { display:flex; gap:12px; margin-bottom:10px; flex-wrap:wrap }
        .form-group { flex:1; min-width:160px; display:flex; flex-direction:column; gap:6px }
        .form-group.full-width { flex:1 1 100% }
        select, input[type="date"], input[type="text"], textarea { 
            padding:10px 12px; 
            border-radius:8px; 
            border:1px solid rgba(0,0,0,0.06); 
            background:linear-gradient(180deg,#fff,#fbfeff); 
            color:var(--text);
        }
        textarea { resize:vertical }

        /* Kanban Board Styles */
        .kanban-board {
            display: flex;
            gap: 18px;
            overflow-x: auto;
            padding: 8px 0;
        }

        .kanban-column {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 6px 18px var(--shadow);
            border: 1px solid rgba(0,0,0,0.03);
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-radius: 8px;
            padding: 12px;
        }

        .column-header.a-fazer {
            background: #ffebee; /* Vermelho pastel bem claro */
        }

        .column-header.em-andamento {
            background: #fff8e1; /* Amarelo pastel bem claro */
        }

        .column-header.concluido {
            background: #e8f5e8; /* Verde pastel bem claro */
        }

        .dark .column-header.a-fazer {
            background: rgba(244, 67, 54, 0.1);
        }

        .dark .column-header.em-andamento {
            background: rgba(255, 193, 7, 0.1);
        }

        .dark .column-header.concluido {
            background: rgba(76, 175, 80, 0.1);
        }

        .column-header h2 {
            font-size: 16px;
            font-weight: 700;
            margin: 0;
        }

        .task-count {
            background: rgba(0,0,0,0.06);
            border-radius: 12px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 700;
        }

        .tasks-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 14px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid rgba(0,0,0,0.04);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .task-type {
            font-size: 11px;
            font-weight: 600;
            color: var(--muted-2);
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .task-title {
            font-size: 15px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: var(--text);
        }

        .task-description {
            font-size: 13px;
            color: var(--muted-2);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .task-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .task-badge.alta {
            background: #fee2e2;
            color: #dc2626;
        }

        .task-badge.media {
            background: #fef3c7;
            color: #d97706;
        }

        .task-badge.baixa {
            background: #d1fae5;
            color: #059669;
        }

        .task-date {
            font-size: 11px;
            color: var(--muted-2);
            font-weight: 600;
        }

        .task-actions {
            display: flex;
            gap: 6px;
        }

        .hidden{display:none}
        .fade-in{animation:fadeIn .28s ease both}
        @keyframes fadeIn{from{opacity:0; transform: translateY(6px)} to{opacity:1; transform:none}}

        @media (max-width:980px){
            .app{padding:0}
            .dashboard{flex-direction:column; min-height:unset}
            .sidebar{width:100%; display:flex; flex-direction:row; gap:10px; overflow:auto; padding:12px}
            .sidebar .menu{flex-direction:row}
            .main{padding:12px}
            .kanban-board {
                flex-direction: column;
            }
            .kanban-column {
                min-width: 100%;
            }
        }
        @media (max-width:560px){
            .sidebar{display:none}
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Dashboard -->
        <section class="dashboard" id="dashboardScreen">
            <!-- SIDEBAR -->
            <aside class="sidebar" role="navigation" aria-label="Navegação">
                <div class="profile">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png" alt="perfil">
                    <div>
                        <h1 id="profileName">Usuário</h1>
                        <small id="profileStatus">Online</small>
                    </div>
                </div>

                <ul class="menu" role="menu" aria-label="Menu principal">
                    <li><button class="menu-item" data-page="index"><i data-lucide="home"></i><span>Dashboard</span></button></li>
                    <li><button class="menu-item" data-page="acoes"><i data-lucide="activity"></i><span>Ações</span></button></li>
                    <li><button class="menu-item" data-page="tarefas"><i data-lucide="list"></i><span>Gestão de tarefas</span></button></li>
                    <li><button class="menu-item" data-page="cadastro"><i data-lucide="user-plus"></i><span>Cadastro</span></button></li>
                    <li><button class="menu-item" data-page="financeiro"><i data-lucide="dollar-sign"></i><span>Financeiro</span></button></li>
                    <li><button class="menu-item" data-page="config"><i data-lucide="settings"></i><span>Configurações</span></button></li>
                </ul>

                <div class="sidebar-footer">
                    <button id="themeToggle" class="menu-btn" aria-pressed="false"><i data-lucide="moon"></i><span id="themeLabel">Tema</span></button>
                    <button id="logoutBtn" class="menu-btn" aria-pressed="false"><i data-lucide="log-out"></i><span>Sair</span></button>
                </div>
            </aside>

            <main class="main" id="mainContent">
                <div class="topbar">
                    <div>
                        <h2 style="margin-bottom:6px">Gestão de Tarefas • Kanban</h2>
                        <div style="color:var(--muted-2); font-size:13px">Organize e acompanhe suas tarefas em um quadro Kanban visual.</div>
                    </div>

                    <div style="display:flex; gap:12px; align-items:center">
                        <div style="font-size:13px; color:var(--muted-2)">Token: <span id="tokenShort" style="font-weight:700; color:var(--text)">—</span></div>
                        <button id="btnNovaTarefa" class="btn btn-primary"><i data-lucide="plus"></i> Nova Tarefa</button>
                        <button id="mobileMenuBtn" class="btn">Menu</button>
                    </div>
                </div>

                <!-- Cards de estatísticas -->
                <section class="cards">
                    <article class="card">
                        <h4>Total de Tarefas</h4>
                        <div class="num" id="totalTasks">15</div>
                    </article>
                    <article class="card">
                        <h4>A Fazer</h4>
                        <div class="num" id="todoTasks">4</div>
                    </article>
                    <article class="card">
                        <h4>Em Andamento</h4>
                        <div class="num" id="doingTasks">5</div>
                    </article>
                    <article class="card">
                        <h4>Concluídas</h4>
                        <div class="num" id="doneTasks">6</div>
                    </article>
                </section>

                <!-- Kanban Board -->
                <div class="kanban-board">
                    <!-- Coluna A Fazer -->
                    <div class="kanban-column">
                        <div class="column-header a-fazer">
                            <h2>A fazer</h2>
                            <span class="task-count">4</span>
                        </div>
                        <div class="tasks-container">
                            <div class="task-card">
                                <div class="task-type">Cadastro</div>
                                <h3 class="task-title">Contato: Teste Pastor</h3>
                                <p class="task-description">Novo contato cadastrado - teste pastor</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">31/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="task-card">
                                <div class="task-type">Cadastro</div>
                                <h3 class="task-title">Contato: Teste 705</h3>
                                <p class="task-description">Novo contato cadastrado - teste 705</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">28/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="task-card">
                                <div class="task-type">Cadastro</div>
                                <h3 class="task-title">Contato: Teste 12345</h3>
                                <p class="task-description">Novo contato cadastrado - teste 12345</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">27/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna Em Andamento -->
                    <div class="kanban-column">
                        <div class="column-header em-andamento">
                            <h2>Em andamento</h2>
                            <span class="task-count">5</span>
                        </div>
                        <div class="tasks-container">
                            <div class="task-card">
                                <div class="task-type">Teste</div>
                                <h3 class="task-title">teste 15</h3>
                                <p class="task-description">Teste</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">31/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="task-card">
                                <div class="task-type">Teste</div>
                                <h3 class="task-title">teste 7</h3>
                                <p class="task-description">Teste 7</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">31/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna Concluído -->
                    <div class="kanban-column">
                        <div class="column-header concluido">
                            <h2>Concluído</h2>
                            <span class="task-count">6</span>
                        </div>
                        <div class="tasks-container">
                            <div class="task-card">
                                <div class="task-type">Cadastro</div>
                                <h3 class="task-title">Contato: Teste Pastor</h3>
                                <p class="task-description">Novo contato cadastrado - teste pastor</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">31/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="task-card">
                                <div class="task-type">Cadastro</div>
                                <h3 class="task-title">Contato: Teste 705</h3>
                                <p class="task-description">Novo contato cadastrado - teste 705</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">28/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="task-card">
                                <div class="task-type">Cadastro</div>
                                <h3 class="task-title">Contato: Teste 12345</h3>
                                <p class="task-description">Novo contato cadastrado - teste 12345</p>
                                <div class="task-footer">
                                    <span class="task-badge media">Média</span>
                                    <span class="task-date">27/07</span>
                                    <div class="task-actions">
                                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </section>
    </div>

    <!-- Modal Nova Tarefa -->
    <div id="modalNovaTarefa" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nova Tarefa</h2>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <form id="formNovaTarefa" class="modal-form" autocomplete="off">
                <div class="form-row">
                    <div class="form-group form-group-wide">
                        <label for="task-title">Título da Tarefa</label>
                        <input type="text" id="task-title" placeholder="Digite um título claro e objetivo para a tarefa" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group form-group-wide">
                        <label for="task-description">Descrição Detalhada</label>
                        <textarea id="task-description" placeholder="Descreva detalhadamente o que precisa ser feito, incluindo requisitos específicos e critérios de aceitação" rows="4" required></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="task-date">Data de Vencimento</label>
                        <input type="date" id="task-date" required>
                    </div>
                    <div class="form-group">
                        <label for="task-assignee">Responsável</label>
                        <input type="text" id="task-assignee" placeholder="Nome do responsável" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="task-priority">Prioridade</label>
                        <select id="task-priority" required>
                            <option value="">Selecione a prioridade</option>
                            <option value="alta">Alta</option>
                            <option value="media">Média</option>
                            <option value="baixa">Baixa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-status">Status</label>
                        <select id="task-status" required>
                            <option value="a-fazer">A fazer</option>
                            <option value="em-andamento">Em andamento</option>
                            <option value="concluido">Concluído</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group form-group-wide">
                        <label for="task-tags">Tags/Categorias</label>
                        <input type="text" id="task-tags" placeholder="Separe as tags por vírgula (ex: frontend, urgente, cliente-x)">
                    </div>
                </div>

                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:8px">
                    <button type="button" id="btnCancelar" class="btn btn-outline">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Tarefa</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // inicializa lucide icons quando disponível
        window.addEventListener('load', ()=> {
            if(window.lucide) lucide.createIcons();
        });

        /* ================= CONFIG ================= */
        // Navegação do menu (simples, carrega outras páginas)
        document.querySelectorAll('.menu-item').forEach(button => {
        button.addEventListener('click', () => {
            const page = button.dataset.page;
            window.location.href = `../paginas/${page}.html`;
        });
        });

        // THEME (persistência)
        const savedTheme = localStorage.getItem('theme');
        function applyTheme(theme){
            if(theme === 'dark'){
                document.documentElement.classList.add('dark');
                themeToggle.setAttribute('aria-pressed','true');
                themeLabel.textContent = 'Claro';
            } else {
                document.documentElement.classList.remove('dark');
                themeToggle.setAttribute('aria-pressed','false');
                themeLabel.textContent = 'Escuro';
            }
            localStorage.setItem('theme', theme);
        }
        // elementos
        const themeToggle = document.getElementById('themeToggle');
        const themeLabel = document.getElementById('themeLabel');
        if(savedTheme) applyTheme(savedTheme);
        else applyTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

        themeToggle.addEventListener('click', ()=>{
            const isDark = document.documentElement.classList.contains('dark');
            applyTheme(isDark ? 'light' : 'dark');
        });

        // MOBILE menu toggle - CORRIGIDO com o mesmo estilo da página Login - Dashboard
        document.getElementById('mobileMenuBtn').addEventListener('click', ()=>{
            const sb = document.querySelector('.sidebar');
            if(getComputedStyle(sb).display === 'none' || sb.style.display === 'none') {
                sb.style.display = 'flex';
            } else {
                sb.style.display = 'none';
            }
        });

        // MENU: navegação para arquivos (ver função pageHref)
        document.querySelectorAll('.menu-item').forEach(btn=>{
            btn.addEventListener('click', ()=>{
                const page = btn.dataset.page;
                const href = pageHref(page);
                // se for a própria página "tarefas", evita recarregar
                if(location.pathname.endsWith('/tarefas.html') || location.pathname.endsWith('tarefas.html')){
                    if(page === 'tarefas' || page === '' ) return;
                }
                window.location.href = href;
            });
        });

        // LOGOUT
        const logoutBtn = document.getElementById('logoutBtn');
        logoutBtn.addEventListener('click', ()=>{
            localStorage.removeItem('token');
            localStorage.removeItem('name');
            // redireciona ao dashboard/index
            window.location.href = pageHref('index');
        });

        // preenche nome do usuário se houver
        const profileName = document.getElementById('profileName');
        const tokenShort = document.getElementById('tokenShort');
        const storedName = localStorage.getItem('name');
        const storedToken = localStorage.getItem('token');
        if(storedName) profileName.textContent = storedName;
        if(storedToken) tokenShort.textContent = storedToken.slice(0,12) + '…';

        /* ========== Modal Nova Tarefa ========== */
        const modal = document.getElementById('modalNovaTarefa');
        const btnNovaTarefa = document.getElementById('btnNovaTarefa');
        const closeModal = document.getElementById('closeModal');
        const btnCancelar = document.getElementById('btnCancelar');
        const formNovaTarefa = document.getElementById('formNovaTarefa');

        function openModal(){
            modal.classList.add('show');
            modal.querySelector('input, textarea').focus();
        }
        function closeModalFn(){
            modal.classList.remove('show');
            formNovaTarefa.reset();
        }

        btnNovaTarefa.addEventListener('click', openModal);
        closeModal.addEventListener('click', closeModalFn);
        btnCancelar.addEventListener('click', closeModalFn);

        // fechar clicando fora do conteúdo
        modal.addEventListener('click', (e)=>{
            if(e.target === modal) closeModalFn();
        });

        // adicionar nova tarefa
        formNovaTarefa.addEventListener('submit', (e)=>{
            e.preventDefault();
            const title = formNovaTarefa['task-title'].value;
            const description = formNovaTarefa['task-description'].value;
            const date = formNovaTarefa['task-date'].value;
            const assignee = formNovaTarefa['task-assignee'].value;
            const priority = formNovaTarefa['task-priority'].value;
            const status = formNovaTarefa['task-status'].value;
            const tags = formNovaTarefa['task-tags'].value;

            // Formata a data para dd/mm
            const dateObj = new Date(date);
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const formattedDate = `${day}/${month}`;

            // Determina a coluna correta
            const columnSelector = {
                'a-fazer': '.kanban-column:nth-child(1) .tasks-container',
                'em-andamento': '.kanban-column:nth-child(2) .tasks-container',
                'concluido': '.kanban-column:nth-child(3) .tasks-container'
            }[status];

            const column = document.querySelector(columnSelector);
            
            // Cria o card da tarefa
            const taskCard = document.createElement('div');
            taskCard.className = 'task-card';
            taskCard.innerHTML = `
                <div class="task-type">${tags.split(',')[0] || 'Tarefa'}</div>
                <h3 class="task-title">${title}</h3>
                <p class="task-description">${description}</p>
                <div class="task-footer">
                    <span class="task-badge ${priority}">${priority.charAt(0).toUpperCase() + priority.slice(1)}</span>
                    <span class="task-date">${formattedDate}</span>
                    <div class="task-actions">
                        <button class="btn-icon" data-action="edit"><i data-lucide="edit-2"></i></button>
                        <button class="btn-icon" data-action="delete"><i data-lucide="trash-2"></i></button>
                    </div>
                </div>
            `;

            // Adiciona a tarefa no início da coluna
            column.prepend(taskCard);
            
            // Atualiza contadores
            updateTaskCounters();
            
            // Re-cria ícones (lucide)
            if(window.lucide) lucide.createIcons();
            
            closeModalFn();
        });

        // Delegation: editar / excluir tarefas
        document.addEventListener('click', (e)=>{
            const btn = e.target.closest('button');
            if(!btn) return;
            
            const action = btn.dataset.action;
            const taskCard = btn.closest('.task-card');
            
            if(action === 'delete'){
                if(confirm('Excluir esta tarefa?')) {
                    taskCard.remove();
                    updateTaskCounters();
                }
            } else if(action === 'edit'){
                // Implementar edição de tarefa
                alert('Funcionalidade de edição será implementada em breve.');
            }
        });

        /* small UX: keyboard esc fecha modal */
        window.addEventListener('keydown', (e)=>{
            if(e.key === 'Escape' && modal.classList.contains('show')) closeModalFn();
        });

        /* ========== Função para atualizar contadores ========== */
        function updateTaskCounters() {
            const todoTasks = document.querySelectorAll('.kanban-column:nth-child(1) .task-card').length;
            const doingTasks = document.querySelectorAll('.kanban-column:nth-child(2) .task-card').length;
            const doneTasks = document.querySelectorAll('.kanban-column:nth-child(3) .task-card').length;
            const totalTasks = todoTasks + doingTasks + doneTasks;
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('todoTasks').textContent = todoTasks;
            document.getElementById('doingTasks').textContent = doingTasks;
            document.getElementById('doneTasks').textContent = doneTasks;
            
            // Atualiza contadores nos cabeçalhos das colunas
            document.querySelector('.kanban-column:nth-child(1) .task-count').textContent = todoTasks;
            document.querySelector('.kanban-column:nth-child(2) .task-count').textContent = doingTasks;
            document.querySelector('.kanban-column:nth-child(3) .task-count').textContent = doneTasks;
        }

        // Inicializa contadores
        updateTaskCounters();
    </script>
</body>
</html>